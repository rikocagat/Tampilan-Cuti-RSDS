<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Pengajuan Cuti</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,Segoe UI;
  background:linear-gradient(180deg,#e0f2fe,#f8fafc);
}

/* ===== HEADER ===== */
.header{
  position:sticky;
  top:0;
  z-index:10;
  background:#ffffffee;
  backdrop-filter:blur(10px);
  display:flex;
  align-items:center;
  padding:12px 14px;
  box-shadow:0 6px 14px rgba(0,0,0,.08);
}
.back{
  text-decoration:none;
  font-size:18px;
  font-weight:800;
  color:#1e40af;
}
.header-title{
  flex:1;
  text-align:center;
  font-weight:900;
  font-size:18px;
  color:#1e3a8a;
  margin-right:24px;
}

/* ===== CONTAINER ===== */
.container{
  max-width:480px;
  margin:auto;
  padding:14px;
}

/* ===== BUTTON AREA ===== */
.action-box{
  display:grid;
  gap:12px;
  margin:10px 0 16px;
}
.action-box a{
  text-decoration:none;
  padding:16px;
  border-radius:18px;
  text-align:center;
  font-weight:800;
  font-size:15px;
  box-shadow:0 10px 22px rgba(0,0,0,.14);
  transition:.2s;
}
.action-box a:active{transform:scale(.97)}
.btn-ajukan{background:linear-gradient(135deg,#2563eb,#1e40af);color:#fff}
.btn-contoh{background:linear-gradient(135deg,#059669,#047857);color:#fff}
.btn-download{background:linear-gradient(135deg,#f59e0b,#d97706);color:#1f2937}

/* ===== SEARCH ===== */
.search{
  width:100%;
  padding:15px 18px;
  border-radius:20px;
  border:none;
  font-size:15px;
  box-shadow:0 8px 20px rgba(0,0,0,.12);
  margin-bottom:16px;
}

/* ===== CARD ===== */
.card{
  background:#fff;
  border-radius:22px;
  padding:18px;
  margin-bottom:18px;
  box-shadow:0 14px 28px rgba(0,0,0,.15);
}
.row{
  display:flex;
  justify-content:space-between;
  gap:14px;
  margin-bottom:6px;
  font-size:14px;
}
.label{color:#64748b}
.value{
  font-weight:800;
  text-align:right;
  color:#0f172a;
}
.status{
  display:inline-block;
  margin-top:14px;
  padding:8px 20px;
  border-radius:999px;
  font-size:13px;
  font-weight:900;
}
.DIAJUKAN{background:#fde68a;color:#92400e}

/* ===== EMPTY ===== */
.empty{
  text-align:center;
  color:#64748b;
  margin-top:40px;
}

/* ===== INFO ACCORDION ===== */
.info{
  background:#fff;
  border-radius:22px;
  margin:22px 0;
  box-shadow:0 12px 24px rgba(0,0,0,.12);
}
.info-header{
  padding:16px 18px;
  font-weight:900;
  color:#1e40af;
  display:flex;
  justify-content:space-between;
  align-items:center;
  cursor:pointer;
}
.info-body{
  display:none;
  padding:0 18px 18px;
  font-size:14px;
  line-height:1.65;
  color:#334155;
}
.info-body h4{
  margin:14px 0 6px;
  color:#0f172a;
}

.footer{
  text-align:center;
  color:#94a3b8;
  font-size:12px;
  margin:12px 0 6px;
}
</style>
</head>

<body>

<!-- HEADER -->
<div class="header">
  <a class="back" href="https://rikoantah.github.io/Web-Utama-UMPAR/">‚Üê</a>
  <div class="header-title">Pengajuan Cuti</div>
</div>

<div class="container">

  <!-- ACTION BUTTON -->
  <div class="action-box">
    <a class="btn-ajukan" href="https://rikocagat.github.io/cuti-rsds-umpar/" target="_blank">‚ûï Ajukan Cuti</a>
    <a class="btn-contoh" href="https://drive.google.com/file/d/12nb8h1-7qXpQQ9T5ps5dwT6Wfhm9t_zx/view" target="_blank">üìÑ Contoh Pengisian Formulir</a>
    <a class="btn-download" href="https://drive.google.com/drive/folders/1nlARa3NYZFuFnkgja1r6IJTxseyu3cs0" target="_blank">‚¨áÔ∏è Download Formulir</a>
  </div>

  <input id="search" class="search" placeholder="üîç Cari nama pegawai‚Ä¶">

  <div id="list"></div>
  <div id="empty" class="empty" style="display:none">Tidak ada data</div>

  <!-- INFO -->
  <div class="info">
    <div class="info-header" onclick="toggleInfo()">
      ‚ÑπÔ∏è Informasi Tambahan
      <span id="icon">+</span>
    </div>
    <div class="info-body" id="infoBody">
      <h4>Cuti Tahunan</h4>12 hari kerja per tahun, minimal kerja 1 tahun.
      <h4>Cuti Besar</h4>3 bulan setelah 5 tahun bekerja.
      <h4>Cuti Sakit</h4>Sesuai rekomendasi dokter.
      <h4>Cuti Melahirkan</h4>3 bulan penuh.
      <h4>Cuti Alasan Penting</h4>Maksimal 2 bulan.
      <h4>CLTN</h4>Maksimal 3 tahun tanpa penghasilan.
      <h4>Cuti Umroh</h4>Termasuk cuti besar, disetujui PPK.
    </div>
  </div>

  <div class="footer">Data terbaru tampil di atas</div>
</div>

<script>
document.addEventListener("DOMContentLoaded", async () => {
  if(!window.supabase){
    alert("Supabase JS gagal dimuat");
    return;
  }

  const client = window.supabase.createClient(
    "https://ufiqibxdgwlysqhinqbz.supabase.co",
    "sb_publishable_EVSVWnsUriOPA_O3RnGTpg_Zmd4pyAL"
  );

  const list = document.getElementById("list");
  const empty = document.getElementById("empty");
  const search = document.getElementById("search");
  let allData = [];

  const fmt = v => v ? new Date(v).toLocaleDateString("id-ID") : "-";

  async function load(){
    const { data } = await client
      .from("pengajuan_cuti")
      .select("nama,nip,jenis_cuti,tgl_mulai,lama_cuti,status,created_at")
      .order("created_at",{ascending:false});

    allData = data || [];
    render(allData);
  }

  function render(arr){
    list.innerHTML="";
    if(arr.length===0){empty.style.display="block";return}
    empty.style.display="none";

    arr.forEach(d=>{
      list.insertAdjacentHTML("beforeend",`
        <div class="card">
          <div class="row"><span class="label">Nama</span><span class="value">${d.nama||"-"}</span></div>
          <div class="row"><span class="label">NIP</span><span class="value">${d.nip||"-"}</span></div>
          <div class="row"><span class="label">Jenis Cuti</span><span class="value">${d.jenis_cuti||"-"}</span></div>
          <div class="row"><span class="label">Tgl Pengajuan</span><span class="value">${fmt(d.created_at)}</span></div>
          <div class="row"><span class="label">Tgl Mulai</span><span class="value">${fmt(d.tgl_mulai)}</span></div>
          <div class="row"><span class="label">Lama</span><span class="value">${d.lama_cuti||"-"} hari</span></div>
          <span class="status ${d.status}">${d.status}</span>
        </div>
      `);
    });
  }

  search.addEventListener("input",e=>{
    const v=e.target.value.toLowerCase();
    render(allData.filter(x=>(x.nama||"").toLowerCase().includes(v)));
  });

  load();
});

function toggleInfo(){
  const b=document.getElementById("infoBody");
  const i=document.getElementById("icon");
  const s=b.style.display==="block";
  b.style.display=s?"none":"block";
  i.textContent=s?"+":"‚àí";
}
</script>
</body>
</html>
